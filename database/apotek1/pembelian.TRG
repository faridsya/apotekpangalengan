TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `tpembelian` BEFORE INSERT ON `pembelian` FOR EACH ROW BEGIN\ndeclare disk double(6,5);declare cek double(19,2);\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tpembelian2` BEFORE UPDATE ON `pembelian` FOR EACH ROW BEGIN\ndeclare disk double(6,5);declare cek double(19,2);\ndeclare vhari int;\nset vhari=old.hari;\nset @vhari=vhari;\nset new.Total_stlh_diskon=new.total-new.total_diskon+new.ttlppn;\ndelete from jurnal where no_transaksi=new.no_pembelian;\ninsert into jurnal values(\'\',new.Tanggal_pembelian,\'1.5\',\'Persediaan barang dagang\',new.Total_stlh_diskon,0,new.no_pembelian,\'\');\nif new.cash is not null and new.cash > 0  then\nif new.cash<=new.total_stlh_diskon then\ndelete from keuangan where no_transaksi=new.no_pembelian and keterangan=\'Transaksi pembelian\';\ninsert into keuangan(Tanggal,Keterangan,Pengeluaran,no_transaksi) values(new.Tanggal_pembelian,\'Transaksi pembelian\',new.cash,new.no_pembelian);\ninsert into jurnal values(\'\',new.Tanggal_pembelian,\'1.1\',\'   Kas\',0,new.cash,new.no_pembelian,\'\');\n\nelse\ndelete from keuangan where no_transaksi=new.no_pembelian and keterangan=\'Transaksi pembelian\';\ninsert into keuangan(Tanggal,Keterangan,Pengeluaran,no_transaksi) values(new.Tanggal_pembelian,\'Transaksi pembelian\',new.total,new.no_pembelian);\n\ninsert into jurnal values(\'\',new.Tanggal_pembelian,\'1.1\',\'   Kas\',0,new.Total_stlh_diskon,new.no_pembelian,\'\');\nend if;\nend if;\nset cek=(select coalesce(jumlah_hutang,0) from hutang where no_pembelian=new.no_pembelian);\nif new.cash<new.total_stlh_diskon then \nif cek!=0 then\ndelete from hutang where no_pembelian=new.no_pembelian;\nend if;\ninsert into hutang values(new.Tanggal_pembelian,new.no_pembelian,new.total_stlh_diskon-new.cash,0,DATE_ADD(new.Tanggal_pembelian,INTERVAL @vhari DAY),new.id_supplier);\ninsert into jurnal values(\'\',new.Tanggal_pembelian,\'2.1\',\'   Utang dagang\',0,new.total_stlh_diskon-new.cash,new.no_pembelian,\'\');\nelse\ndelete from hutang where no_pembelian=new.no_pembelian;\ninsert into hutang values(new.Tanggal_pembelian,new.no_pembelian,0,0,DATE_ADD(new.Tanggal_pembelian,INTERVAL 0 DAY),new.id_supplier);\nend if;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tpembelian3` AFTER DELETE ON `pembelian` FOR EACH ROW BEGIN\ndelete from detilbeli where no_pembelian=old.no_pembelian;\ndelete from hutang  where no_pembelian=old.no_pembelian;\ndelete from byr_hutang  where no_pembelian=old.no_pembelian;\ndelete from keuangan  where no_transaksi=old.no_pembelian;\ndelete from jurnal  where no_transaksi=old.no_pembelian;\nEND'
sql_modes=1342177280 1342177280 1342177280
definers='root@localhost' 'root@localhost' 'root@localhost'
