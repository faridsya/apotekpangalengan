TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `tdetiljual2` AFTER DELETE ON `detiljual` FOR EACH ROW BEGIN\ndeclare ttl double;declare cek double (19,2);\ndeclare disk double;\nset ttl=(select coalesce(sum(`Harga_jual` * `jumlah_brg`),0)from detiljual where `No_Penjualan`=old.no_penjualan);\nset disk=(select coalesce(sum(diskon),0)from detiljual where `No_Penjualan`=old.no_penjualan);\nset @ttl=ttl;set @disk=disk;\nset cek=(select coalesce(total,0) from penjualan where no_penjualan=old.no_penjualan);\nif cek!=0 then\nupdate penjualan set `jumlah`=@ttl,total_diskon=@disk where `no_penjualan`=old.no_penjualan;\nend if;\nupdate stokgudang set jumlah=jumlah+old.jumlah_brg where kode_gudang=old.kode_gudang and kode_brg=old.kode_brg;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tdetiljualai` AFTER INSERT ON `detiljual` FOR EACH ROW BEGIN\ndeclare ttl double;declare vppn double;\ndeclare disk double;\nset vppn=(select coalesce(sum(ppn),0)from detiljual where `No_Penjualan`=new.no_penjualan);\nset ttl=(select coalesce(sum(`Harga_jual` * `jumlah_brg`),0)from detiljual where `No_Penjualan`=new.no_penjualan);\nset disk=(select coalesce(sum(diskon),0)from detiljual where `No_Penjualan`=new.no_penjualan);\nset disk=disk-(disk-new.diskon);\nset @ttl=ttl;set @disk=disk;set @ppn=vppn;\nupdate penjualan set ppn=@ppn,`jumlah`=@ttl,total_diskon=total_diskon+@disk where `no_penjualan`=new.no_penjualan;\nupdate stokgudang set jumlah=jumlah-new.jumlah_brg where kode_brg=new.kode_brg and kode_gudang=new.kode_gudang;\nEND'
sql_modes=1342177280 1342177280
definers='root@localhost' 'root@localhost'
