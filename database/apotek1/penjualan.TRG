TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `tpenjualan` BEFORE INSERT ON `penjualan` FOR EACH ROW BEGIN\ndeclare disk double(6,5);declare cek double(19,2);\nif new.cash=new.total then\nset new.keterangan1=\'C\';set new.keterangan2=\'L\';\nend if;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tpenjualan3` AFTER DELETE ON `penjualan` FOR EACH ROW BEGIN\ndelete from detiljual where no_penjualan=old.no_penjualan;\ndelete from piutang  where no_penjualan=old.no_penjualan;\ndelete from byr_piutang  where no_penjualan=old.no_penjualan;\ndelete from keuangan  where no_transaksi=old.no_penjualan;\ndelete from detilreturjual  where no_penjualan=old.no_penjualan;\ndelete from jurnal  where no_transaksi=old.no_penjualan;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tpenjualanai` AFTER INSERT ON `penjualan` FOR EACH ROW BEGIN\nif new.jenis="resep" and new.komisi>0 then\ninsert into keuangan(Tanggal,Keterangan,jenis,Pengeluaran,no_transaksi) values(new.Tanggal,\'Komisi dokter\',\'Komisi dokter\',new.komisi,new.no_penjualan);\n\nend if;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tpenjualan2` BEFORE UPDATE ON `penjualan` FOR EACH ROW BEGIN\ndeclare disk double(6,5);declare cek double(19,2);\ndeclare vhari int;declare vdpst double(19,2);declare vbyr double(19,2);\nset vhari=old.hari;\nset @vhari=vhari;\nset new.Total=new.jumlah-new.total_diskon+new.ppn;\ndelete from jurnal where no_transaksi=new.no_penjualan and no_akun!=\'5.9\';\nif new.cash is not null and new.cash > 0  then\ndelete from keuangan where no_transaksi=new.no_penjualan and keterangan=\'Transaksi penjualan\';\nif new.cash<=new.total then\ninsert into keuangan(Tanggal,Keterangan,Pemasukan,no_transaksi) values(new.Tanggal,\'Transaksi penjualan\',new.cash,new.no_penjualan);\ninsert into jurnal values(\'\',new.Tanggal,\'1.1\',\'Kas\',new.cash,0,new.no_penjualan,\'\');\n\nelse\ninsert into keuangan(Tanggal,Keterangan,Pemasukan,no_transaksi) values(new.Tanggal,\'Transaksi penjualan\',new.total,new.no_penjualan);\ninsert into jurnal values(\'\',new.Tanggal,\'1.1\',\'Kas\',new.total,0,new.no_penjualan,\'\');\n\n\nend if;\nend if;\n\n\n/*cek deposit pelanggan*/\nset vdpst=(select jumlah_piutang from pelanggan where id_pelanggan=new.id_pelanggan);\nset vbyr=0;\nif vdpst<0 then\nset vdpst=-1*vdpst;\n 	  if vdpst>new.total then\n 	  set vbyr=new.total;\n 	  else\n 	  set vbyr=vdpst;\n 	  end if;\n 	  \nend if;\nset @vbyr=vbyr;\n\nset cek=(select coalesce(jumlah_piutang,0) from piutang where no_penjualan=new.no_penjualan);\nif new.cash<new.total then \nif cek!=0 then\ndelete from piutang where no_penjualan=new.no_penjualan;\nend if;\ninsert into piutang values(new.Tanggal,new.no_penjualan,new.total-new.cash,0,DATE_ADD(new.Tanggal,INTERVAL @vhari DAY),new.id_pelanggan);\ninsert into jurnal values(\'\',new.Tanggal,\'1.3\',\'Piutang\',new.total-new.cash,0,new.no_penjualan,\'\');\nelse\ndelete from piutang where no_penjualan=new.no_penjualan;\ninsert into piutang values(new.Tanggal,new.no_penjualan,0,0,DATE_ADD(new.Tanggal,INTERVAL 0 DAY),new.id_pelanggan);\nend if;\ninsert into jurnal values(\'\',new.Tanggal,\'8.1\',\'   Penjualan\',0,new.total,new.no_penjualan,\'\');\ninsert into jurnal values(\'\',new.Tanggal,\'8.2\',\'HPP\',new.harga_pokok_jual,0,new.no_penjualan,\'\');\ninsert into jurnal values(\'\',new.Tanggal,\'1.5\',\'   Persediaan barang dagang\',0,new.harga_pokok_jual,new.no_penjualan,\'\');\nif new.jenis=\'resep\'and new.komisi>0 then \ninsert into jurnal values(null,new.Tanggal,\'1.1\',\'Kas\',new.komisi,0,new.no_penjualan,\'\');\ninsert into jurnal values(null,new.Tanggal,\'5.9\',\'   Komisi dokter\',0,new.komisi,new.no_penjualan,\'\');\nend if;\nEND'
sql_modes=1342177280 1342177280 1342177280 1342177280
definers='root@localhost' 'root@localhost' 'root@localhost' 'root@localhost'
