TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `treturjual` BEFORE UPDATE ON `retur_jual` FOR EACH ROW BEGIN\ndeclare vid varchar(20);declare cekutang double(19,2);\nset vid=(select id_pelanggan from penjualan where no_penjualan=new.no_penjualan);\n\nset @vid=vid;\nset cekutang= (select jumlah_piutang from pelanggan where id_pelanggan= @vid);\nif vid=\'bebas\' then\n\n\ndelete from keuangan where no_transaksi=new.no_retur;\ninsert into keuangan(tanggal,keterangan,pengeluaran,jenis,no_transaksi) values (new.tanggal,\'Retur jual\',new.total,\'Retur jual\',new.no_retur);\ndelete from jurnal where no_transaksi=new.no_retur;\ninsert into jurnal values(\'\',new.Tanggal,\'8.4\',\'Retur jual\',new.total,0,new.no_retur,\'\');\ninsert into jurnal values(\'\',new.Tanggal,\'1.1\',\'   Kas\',0,new.total,new.no_retur,\'\');\ninsert into jurnal values(\'\',new.Tanggal,\'1.5\',\'Persediaan barang dagang\',new.hpp,0,new.no_retur,\'\');\ninsert into jurnal values(\'\',new.Tanggal,\'8.2\',\'   HPP\',0,new.hpp,new.no_retur,\'\');\nelse\ndelete from jurnal where no_transaksi=new.no_retur;\ninsert into jurnal values(\'\',new.Tanggal,\'8.4\',\'Retur jual\',new.total,0,new.no_retur,\'\');\ninsert into jurnal values(\'\',new.Tanggal,\'1.3\',\'   Piutang dagang\',0,new.total,new.no_retur,\'\');\ninsert into jurnal values(\'\',new.Tanggal,\'1.5\',\'Persediaan barang dagang\',new.hpp,0,new.no_retur,\'\');\ninsert into jurnal values(\'\',new.Tanggal,\'8.2\',\'   HPP\',0,new.hpp,new.no_retur,\'\');\n\nend if;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `treturjual2` BEFORE DELETE ON `retur_jual` FOR EACH ROW BEGIN\ndeclare vid varchar(20);\ndelete from keuangan where no_transaksi=old.no_retur;\ndelete from detilreturjual where no_retur=old.no_retur;\ndelete from jurnal where no_transaksi=old.no_retur;\nset vid=(select id_pelanggan from penjualan where no_penjualan=old.no_penjualan);\nset @vid=vid;\nif @vid!=\'bebas\' then\nupdate piutang set jumlah_piutang=jumlah_piutang+old.total where no_penjualan=old.no_penjualan;\nupdate pelanggan set jumlah_piutang=jumlah_piutang+old.total where id_pelanggan=@vid;\nelse\ndelete from keuangan where no_transaksi=old.no_retur;\nend if;\ndelete from detilreturjual where no_retur=old.no_retur;\nEND'
sql_modes=1342177280 1342177280
definers='root@localhost' 'root@localhost'
