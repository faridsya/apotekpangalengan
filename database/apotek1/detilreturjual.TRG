TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `detilreturjual3` AFTER INSERT ON `detilreturjual` FOR EACH ROW BEGIN\ndeclare vttl double(19,2);declare vttl2 double(19,2);\nset vttl=(select coalesce(sum(`total`),0)from detilreturjual where `No_retur`=new.No_retur);\nset vttl2=(select coalesce(sum(`jumlah`),0)from detilreturjual where `No_retur`=new.No_retur);\nset @vttl=vttl;set @vttl2=vttl2;\nupdate retur_jual set `total`=@vttl,total_brg=@vttl2 where `No_retur`=new.`No_retur`;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tdtlrtrjual` BEFORE INSERT ON `detilreturjual` FOR EACH ROW BEGIN\ndeclare vharga double(19,2);declare vdisc double(19,2);declare vttl double(19,2);declare vhargabeli double(19,2);\ndeclare vkodegdg varchar(50);declare vid varchar(20);declare vidp varchar(20);declare vhpp double(19,2);\nset vid=(select no_penjualan from retur_jual where no_retur=new.no_retur);\nset @vid=vid;\nset vkodegdg=(select kode_gudang from detiljual where no_penjualan=@vid and kode_brg=new.kode_brg);\nset @vkodegdg=vkodegdg;\nset vharga=(Select harga_jual from detiljual where no_penjualan=@vid and kode_brg=new.kode_brg);\nset vhargabeli=(Select harga_beli from detiljual where no_penjualan=@vid and kode_brg=new.kode_brg);\nset vhpp=vhargabeli*new.jumlah;\nset vdisc=(select (diskon/jumlah_brg) from detiljual where no_penjualan=@vid and kode_brg=new.kode_brg);\nset @vharga=vharga;set @vdisc=vdisc;\nset new.harga_jual=@vharga;set new.diskon=@vdisc*new.jumlah;\nset new.total=new.harga_jual*new.jumlah-new.diskon;\nupdate stokgudang set jumlah=jumlah+new.jumlah where kode_brg=new.kode_brg and kode_gudang=@vkodegdg;\n\nupdate retur_jual set hpp=hpp+vhpp where no_retur=new.no_retur;\nset vidp=(select id_pelanggan from penjualan where no_penjualan=new.no_penjualan);\n\nset @vidp=vidp;\n\nif vidp!=\'bebas\' then\nupdate piutang set jumlah_piutang=jumlah_piutang-new.total where no_penjualan=vid;\nupdate pelanggan set jumlah_piutang=jumlah_piutang-new.total where id_pelanggan=vidp;\nend if;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tdtlrtrjual2` AFTER DELETE ON `detilreturjual` FOR EACH ROW BEGIN\ndeclare vkodegdg varchar(50);declare vid varchar(20);\nset vid=(select no_penjualan from retur_jual where no_retur=old.no_retur);\nset vkodegdg=(select kode_gudang from detiljual where no_penjualan=old.no_penjualan and kode_brg=old.kode_brg);\nset @vkodegdg=vkodegdg;set @vid=vid;\nupdate stokgudang set jumlah=jumlah-old.jumlah where kode_brg=old.kode_brg and kode_gudang=@vkodegdg;\n\nEND'
sql_modes=1342177280 1342177280 1342177280
definers='root@localhost' 'root@localhost' 'root@localhost'
