TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `tdetilbeli` AFTER INSERT ON `detilbeli` FOR EACH ROW BEGIN\ndeclare ttl double;declare vhpp double;\ndeclare disk double;\ndeclare vppn double;\nset ttl=(select coalesce(sum(`Harga_beli` * `jumlah_brg`),0)from detilbeli where `No_pembelian`=new.no_pembelian);\nset disk=(select coalesce(sum(diskon),0)from detilbeli where `No_Pembelian`=new.no_pembelian);\nset vppn=(select coalesce(sum(ppn),0)from detilbeli where `No_Pembelian`=new.no_pembelian);\n\nset @ttl=ttl;set @disk=disk;set @ppn=vppn;\nupdate pembelian set `total`=@ttl,total_diskon=@disk,ttlppn=@ppn where `no_pembelian`=new.no_pembelian;\nupdate stokgudang set jumlah=jumlah+new.jumlah_brg where kode_gudang=new.kode_gudang and kode_brg=new.kode_brg;\n\n#update tblbarang\nif new.batch!=\'\' then\nupdate tblbarang set batch=new.batch where kode_brg=new.kode_brg;\nend if;\n\nif new.tgl_exp is not null then\nupdate tblbarang set tgl_expire=new.tgl_exp where kode_brg=new.kode_brg;\nend if;\n\n#cek hpp\nset vhpp=(select harga_beli from tblbarang where kode_brg=new.kode_brg);\nif vhpp!=new.harga_beli then\nupdate tblbarang set harga_beli=new.harga_beli,harga_jual=((harga_jual/vhpp)*new.harga_beli),\nharga_jual2=((harga_jual2/vhpp)*new.harga_beli),harga_jual3=((harga_jual3/vhpp)*new.harga_beli) where kode_brg=new.kode_brg;\nend if;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tdetilbeli2` AFTER DELETE ON `detilbeli` FOR EACH ROW BEGIN\ndeclare ttl double;declare cek double (19,2);\ndeclare disk double;declare vppn double;\nset ttl=(select coalesce(sum(`Harga_beli` * `jumlah_brg`),0)from detilbeli where `No_Pembelian`=old.No_Pembelian);\nset disk=(select coalesce(sum(diskon),0)from detilbeli where `No_Pembelian`=old.No_Pembelian);\nset vppn=(select coalesce(sum(ppn),0)from detilbeli where `No_Pembelian`=old.no_pembelian);\nset @ttl=ttl;set @disk=disk; set @ppn=vppn;\nset cek=(select coalesce(total,0) from pembelian where no_pembelian=old.No_Pembelian);\nif cek!=0 then\nupdate pembelian set `total`=@ttl,total_diskon=@disk,ttlppn=@ppn where `No_pembelian`=old.No_Pembelian;\nend if;\nupdate stokgudang set jumlah=jumlah-old.jumlah_brg where kode_gudang=old.kode_gudang and kode_brg=old.kode_brg;\nEND'
sql_modes=1342177280 1342177280
definers='root@localhost' 'root@localhost'
