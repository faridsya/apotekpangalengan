TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `tdtlrtrbeli2` AFTER DELETE ON `detilreturbeli` FOR EACH ROW BEGIN\ndeclare vkodegdg varchar(50);declare vid varchar(20);\nset vid=(select no_pembelian from retur_beli where no_retur=old.no_retur);\nset vkodegdg=(select kode_gudang from detilbeli where no_pembelian=old.no_pembelian and kode_brg=old.kode_brg);\nset @vkodegdg=vkodegdg;set @vid=vid;\nupdate stokgudang set jumlah=jumlah+old.jumlah where kode_brg=old.kode_brg and kode_gudang=@vkodegdg;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tdtlrtrbeli3` AFTER INSERT ON `detilreturbeli` FOR EACH ROW BEGIN\ndeclare vttl double(19,2);declare vttl2 double(19,2);\nset vttl=(select coalesce(sum(`total`),0)from detilreturbeli where `No_retur`=new.No_retur);\nset vttl2=(select coalesce(sum(`jumlah`),0)from detilreturbeli where `No_retur`=new.No_retur);\nset @vttl=vttl;set @vttl2=vttl2;\nupdate retur_beli set `total`=@vttl,total_brg=@vttl2 where `No_retur`=new.`No_retur`;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `tdtlrtrbelibi` BEFORE INSERT ON `detilreturbeli` FOR EACH ROW BEGIN\n\ndeclare vharga double(19,2);declare vdisc double(19,2);declare vttl double(19,2);\ndeclare vkodegdg varchar(50);declare vid varchar(20);declare vidp varchar(20);\nset vid=(select no_pembelian from retur_beli where no_retur=new.no_retur);\nset @vid=vid;\nset vkodegdg=(select kode_gudang from detilbeli where no_pembelian=@vid and kode_brg=new.kode_brg);\nset @vkodegdg=vkodegdg;\nset vharga=(Select harga_beli from detilbeli where no_pembelian=@vid and kode_brg=new.kode_brg);\nset vdisc=(select (diskon/jumlah_brg) from detilbeli where no_pembelian=@vid and kode_brg=new.kode_brg);\nset @vharga=vharga;set @vdisc=vdisc;\nset new.harga_beli=@vharga;set new.diskon=@vdisc*new.jumlah;\nset new.total=new.harga_beli*new.jumlah-new.diskon;\nupdate stokgudang set jumlah=jumlah-new.jumlah where kode_brg=new.kode_brg and kode_gudang=@vkodegdg;\n\nset vidp=(select id_supplier from pembelian where no_pembelian=new.no_pembelian);\n\nset @vidp=vidp;\n\nupdate hutang set jumlah_hutang=jumlah_hutang-new.total where no_pembelian=@vid;\nupdate tblsupplier set jumlah_hutang=jumlah_hutang-new.total where id_supplier=vidp;\n\nEND'
sql_modes=1342177280 1342177280 1342177280
definers='root@localhost' 'root@localhost' 'root@localhost'
